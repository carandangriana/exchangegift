<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GAME GAME</title>
<style>
    body { font-family: Arial, sans-serif; text-align: center; background-color: #f0f0f0; padding: 20px; }
    h1 { font-size: 40px; margin-bottom: 10px; }
    #welcome { font-size: 20px; margin-bottom: 10px; color: #333; }
    .participant-btn {
        display: block;
        width: 250px;
        margin: 10px auto;
        padding: 15px;
        font-size: 20px;
        background-color: #db6ad7;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        color: black;
        transition: 0.3s;
    }
    .participant-btn.chosen { 
        background-color: #888; 
        text-decoration: line-through; 
        color: white; 
        cursor: not-allowed; 
        pointer-events: none;
    }
    #modal { display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); justify-content: center; align-items: center; }
    #modalContent { background: white; padding: 30px; border-radius: 10px; width: 90%; max-width: 400px; text-align: center; }
    #modal input { width: 90%; padding: 10px; margin-top: 10px; font-size: 18px; box-sizing: border-box; }
    #submitName { margin-top: 15px; padding: 10px 20px; font-size: 18px; cursor: pointer; border-radius: 5px; border: none; background-color: #4CAF50; color: white; }
    #submitName:hover { background-color: #45a049; }
    #assignment { font-size: 22px; color: #ff6600; margin-top: 10px; font-weight: bold; }
    #error { color: red; margin-top: 10px; }
</style>
</head>
<body>

<h1>GAME GAME</h1>
<p id="welcome"></p>
<p>After seeing who you drew, click your assigned person to mark it (anonymous).</p>

<div id="participantContainer"></div>
<p id="assignment"></p>

<div id="modal">
  <div id="modalContent">
    <h2>Login</h2>
    <input type="text" id="nameInput" placeholder="Enter your name (exact spelling)">
    <input type="password" id="passwordInput" placeholder="Enter your password">
    <button id="submitName">Submit</button>
    <p id="error"></p>
  </div>
</div>

<script>
// Participants, credentials, and assignments
const participants = ["RIANA","ROXANNE","AIRHA","KISHIA","CAMILLE","KAE","KRISTINA","BRICKS"];
const credentials = {
    "RIANA": "r123", "ROXANNE": "roxpass", "AIRHA": "a1rha", 
    "KISHIA": "kishi@", "CAMILLE": "camepw", "KAE": "okaeee", 
    "KRISTINA": "mossing", "BRICKS": "brikoy"
};
const assignments = {
    "RIANA": "CAMILLE", "CAMILLE": "KRISTINA", "KISHIA": "RIANA",
    "KRISTINA": "BRICKS", "BRICKS": "ROXANNE", "ROXANNE": "AIRHA",
    "AIRHA": "KAE", "KAE": "KISHIA"
};

let loggedInUser = null;
const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbytDu3UioUrULTKmC6yRLAKhRwWTSgmhynduahqKC6Xb6DsGZt9_qaIsCYWSKNwl9Z2/exec"; // replace with your deployed Google Script URL
const buttons = {};

// Create buttons
const container = document.getElementById("participantContainer");
participants.forEach(p => {
    const btn = document.createElement("button");
    btn.className = "participant-btn";
    btn.textContent = p;
    btn.dataset.name = p;
    buttons[p] = btn;

    btn.addEventListener("click", async () => {
        if (!loggedInUser) { alert("Please log in first."); return; }
        if (btn.disabled) { alert("This person has already been chosen."); return; }
        if (assignments[loggedInUser] !== p) { alert("This is not your assigned person."); return; }

        // Mark locally
        btn.classList.add("chosen");
        btn.disabled = true;

        // Send to Google Sheet
        try {
            const res = await fetch(SHEET_API_URL, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({assignedPerson: p, chosenBy: loggedInUser})
            });
            const data = await res.json();
            if(data.success) {
                alert(`${p} is now marked as chosen (anonymous).`);
                fetchChosenStatus();
            }
        } catch(err) {
            alert("Someone else may have picked this already.");
        }
    });

    container.appendChild(btn);
});

// Login modal logic
const modal = document.getElementById("modal");
const nameInput = document.getElementById("nameInput");
const passwordInput = document.getElementById("passwordInput");
const submitBtn = document.getElementById("submitName");
const errorText = document.getElementById("error");
const assignmentText = document.getElementById("assignment");
const welcomeText = document.getElementById("welcome");

submitBtn.onclick = loginUser;
function loginUser() {
    const nameRaw = nameInput.value.trim().toUpperCase();
    const pass = passwordInput.value;
    errorText.textContent = "";

    if (!nameRaw) return errorText.textContent = "Please enter your name.";
    if (!participants.includes(nameRaw)) return errorText.textContent = "Invalid name.";
    if (!pass) return errorText.textContent = "Please enter your password.";
    if (credentials[nameRaw] !== pass) return errorText.textContent = "Invalid password.";

    loggedInUser = nameRaw;
    modal.style.display = "none";
    welcomeText.textContent = `Logged in as: ${loggedInUser}`;
    assignmentText.textContent = `ðŸŽ Ang maswerteng nabunot mo ay si: ${assignments[loggedInUser]}`;

    fetchChosenStatus();
}

// Close modal when clicking outside
modal.addEventListener('click', e => { if(e.target === modal) modal.style.display='none'; });

// Enter key support
nameInput.addEventListener('keypress', e => { if(e.key==='Enter') passwordInput.focus(); });
passwordInput.addEventListener('keypress', e => { if(e.key==='Enter') loginUser(); });

// Fetch chosen status
async function fetchChosenStatus() {
    try {
        const res = await fetch(SHEET_API_URL);
        const data = await res.json();
        data.forEach(item => {
            if (!item.chosenBy) return; // skip unchosen
            const btn = buttons[item.assigned];
            if (!btn) return;
            // Disable only if someone else picked it
            if (item.chosenBy !== loggedInUser) {
                btn.classList.add("chosen");
                btn.disabled = true;
            }
        });
    } catch(err) { console.log("Error fetching chosen status", err); }
}
</script>

</body>
</html>
